# Change: 添加标签和文档引用系统

## Why
当前 FireFire 严重依赖文件夹结构来组织笔记，这带来以下问题：
1. **认知负担高**：用户需要先思考"这个笔记应该放在哪个文件夹"
2. **打开门槛高**：每次记笔记都要先选择或创建文件夹
3. **灵活性差**：一个笔记只能属于一个文件夹，无法多维度分类
4. **关联性弱**：笔记之间的关联关系无法直观表达

现代笔记应用（Notion、Obsidian、Roam Research）的核心理念是：
- **快速捕获**：打开即写，无需关心组织结构
- **灵活标记**：使用标签进行多维度分类
- **知识图谱**：通过链接建立笔记间的关系网络

## What Changes
实现两大核心功能，让 FireFire 从"文件管理器"转变为"知识网络"：

### 1. 标签系统（Tags）
- **快速打标签**：编辑器内输入 `#标签名` 自动创建标签
- **标签管理**：侧边栏显示所有标签，点击查看该标签下的笔记
- **多标签支持**：一个笔记可以有多个标签
- **标签云**：可视化显示标签使用频率
- **标签搜索**：快速筛选带特定标签的笔记

### 2. 内部链接系统（Internal Links）
- **Wiki 风格链接**：输入 `[[笔记名称]]` 创建链接
- **自动补全**：输入 `[[` 时弹出笔记列表
- **反向链接**：显示哪些笔记链接到当前笔记
- **快速创建**：链接不存在的笔记时自动创建
- **图谱可视化**：显示笔记之间的连接关系

### 3. 快速开始体验优化
- **去除强制文件夹选择**：应用启动直接进入"快速笔记"
- **智能默认位置**：新笔记默认保存到 `Quick Notes/` 文件夹
- **延迟组织**：用户可以稍后通过标签和链接整理笔记
- **搜索优先**：强化全文搜索，弱化文件夹导航

### 4. UI 重构
**现有（文件夹为主）**：
```
侧边栏：文件夹树
主区域：选中文件夹 → 文件列表 → 编辑器
```

**改进后（标签 + 搜索为主）**：
```
侧边栏：
  - 快速笔记按钮 ✨
  - 全部笔记
  - 标签列表 🏷️
  - 文件夹（折叠，可选）

主区域：
  - 搜索栏（全文搜索）
  - 笔记列表（按时间/标签筛选）
  - 编辑器（支持 #标签 和 [[链接]]）

右侧栏（可选）：
  - 大纲
  - 反向链接
  - 关系图谱
```

## Impact
- Affected specs: 无（新功能）
- Affected code:
  - **新增**：
    - `src/common/extensions/tagExtension.js` - 标签 Tiptap 扩展
    - `src/common/extensions/linkExtension.js` - 链接 Tiptap 扩展
    - `src/components/TagCloud.jsx` - 标签云组件
    - `src/components/BackLinks.jsx` - 反向链接组件
    - `src/components/GraphView.jsx` - 图谱视图组件
    - `electron/tagManager.js` - 标签索引管理
    - `electron/linkManager.js` - 链接索引管理
  - **修改**：
    - `src/pages/file/fileList.jsx` - 添加标签视图
    - `src/pages/file/markdown.jsx` - 集成标签和链接
    - `electron/notebookFile.js` - 保存标签和链接元数据
- Breaking: 无（向后兼容）
- Risk: 中等
  - 需要构建标签和链接索引
  - 大量笔记时性能需要优化
  - 数据结构需要扩展

## Dependencies
新增 npm 包：
- `d3` 或 `vis-network` - 图谱可视化（可选）
- 无新增 Tiptap 扩展依赖（可基于现有 API 实现）

## Implementation Plan
分三个阶段实施：

### 阶段 1：标签系统（核心）
1. 实现 `#标签` Tiptap 扩展
2. 标签数据存储和索引
3. 侧边栏标签列表
4. 按标签筛选笔记

### 阶段 2：内部链接系统
1. 实现 `[[链接]]` Tiptap 扩展
2. 链接自动补全
3. 反向链接显示
4. 快速创建链接笔记

### 阶段 3：快速开始优化
1. 移除强制文件夹选择
2. "快速笔记"按钮
3. 智能默认保存位置
4. UI 重构（标签优先）

## Success Metrics
- **降低使用门槛**：从打开到开始写作 < 3 秒
- **提升组织灵活性**：平均每个笔记有 2-3 个标签
- **增强关联性**：笔记间平均有 1-2 个链接

## 兼容性
- ✅ 向后兼容：现有文件夹结构保持不变
- ✅ 平滑迁移：用户可以逐步从文件夹迁移到标签
- ✅ 混合使用：支持同时使用文件夹、标签和链接
