/* 极简风格编辑器 */
.tiptap {
  height: 100%;
  min-height: 100%;
}

.ProseMirror {
  height: 100%;
  min-height: 100%;
  overflow-y: auto;
  width: 100%;
  max-width: var(--doc-width, 700px);
  margin: 0 auto;
  padding: 3rem 3rem 6rem;
  color: var(--fg, #37352f);
  font-size: 16px;
  line-height: 1.6;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Noto Sans SC", "Microsoft YaHei", sans-serif;
  background: var(--bg, white);
  outline: none;

  // 滚动条美化（简化）
  &::-webkit-scrollbar {
    width: 8px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
  }

  &::-webkit-scrollbar-thumb {
    background: var(--gray-300);
    border-radius: 4px;

    &:hover {
      background: var(--gray-400);
    }
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    line-height: 1.3;
    font-weight: 700;
    margin: 2rem 0 0.75rem;
    color: var(--fg);
    letter-spacing: -0.02em;
  }

  h1 {
    font-size: 2.25rem;
    margin-top: 2.5rem;
  }

  h2 {
    font-size: 1.875rem;
    margin-top: 2rem;
  }

  h3 {
    font-size: 1.5rem;
  }

  h4 {
    font-size: 1.25rem;
  }

  h5 {
    font-size: 1.125rem;
  }

  h6 {
    font-size: 1rem;
    color: var(--muted);
  }

  p { margin: 0.75rem 0; }

  ul,
  ol {
    padding-left: 1.5rem;
    margin: 0.75rem 0;
  }

  li { margin: 0.25rem 0; }

  blockquote {
    margin: 1rem 0;
    padding: 0.5rem 1rem;
    border-left: 3px solid var(--border, #e5e5e5);
    background: var(--gray-50);
    color: var(--muted, #737373);
  }

  hr {
    height: 1px;
    border: none;
    background: var(--border, #e5e5e5);
    margin: 2rem 0;
  }

  code {
    background: var(--gray-100);
    color: var(--gray-800);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm, 4px);
    padding: 0.125rem 0.375rem;
    font-family: Menlo, SFMono-Regular, Consolas, "JetBrainsMono", monospace;
    font-size: 0.9em;
  }

  pre {
    background: var(--gray-900, #171717);
    color: var(--gray-50, #fafafa);
    font-family: Menlo, SFMono-Regular, Consolas, "JetBrainsMono", monospace;
    padding: 1rem 1.25rem;
    border-radius: var(--radius-lg, 8px);
    overflow: auto;
    -webkit-overflow-scrolling: touch;

    code {
      color: inherit;
      padding: 0;
      background: none;
      border: none;
      font-size: 0.9rem;
    }

    // 简化代码高亮配色
    .hljs-comment,
    .hljs-quote { color: #8a8f98; }
    .hljs-variable,
    .hljs-template-variable,
    .hljs-attribute,
    .hljs-tag,
    .hljs-name,
    .hljs-regexp,
    .hljs-link,
    .hljs-selector-id,
    .hljs-selector-class { color: #ff7b72; }
    .hljs-number,
    .hljs-meta,
    .hljs-built_in,
    .hljs-builtin-name,
    .hljs-literal,
    .hljs-type,
    .hljs-params { color: #d2a8ff; }
    .hljs-string,
    .hljs-symbol,
    .hljs-bullet { color: #a5d6ff; }
    .hljs-title,
    .hljs-section { color: #f2cc60; }
    .hljs-keyword,
    .hljs-selector-tag { color: #79c0ff; }
    .hljs-emphasis { font-style: italic; }
    .hljs-strong { font-weight: 700; }
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
    display: block;
    overflow-x: auto;
    font-size: 0.95rem;
  }
  th, td {
    border: 1px solid var(--border, #e5e5e5);
    padding: 0.625rem 0.875rem;
    text-align: left;
  }
  thead th {
    background: var(--gray-100, #f5f5f5);
    font-weight: 600;
    color: var(--fg);
  }
  tbody tr:nth-child(even) {
    background: var(--gray-50, #fafafa);
  }
  tbody tr:hover {
    background: var(--primary-light, rgba(37, 184, 100, 0.08));
  }

  /* 链接样式 */
  a {
    color: var(--primary, #25b864);
    text-decoration: none;
    &:hover { text-decoration: underline; }
  }

  /* 任务列表 */
  ul[data-type="taskList"] {
    list-style: none;
    padding-left: 0;
    margin: 0.75rem 0;
  }
  ul[data-type="taskList"] li {
    display: flex;
    align-items: flex-start;
    gap: 0.625rem;
    margin: 0.5rem 0;
    padding: 0.25rem 0;
  }
  ul[data-type="taskList"] li > label {
    display: flex;
    align-items: center;
    margin-top: 0.125rem;
  }
  ul[data-type="taskList"] li input[type="checkbox"] {
    appearance: none;
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid var(--border, #d4d4d4);
    border-radius: 4px;
    background: var(--bg, white);
    cursor: pointer;
    transition: all 0.15s ease;
    position: relative;

    &:hover {
      border-color: var(--primary, #25b864);
    }

    &:checked {
      background: var(--primary, #25b864);
      border-color: var(--primary, #25b864);

      &::after {
        content: '';
        position: absolute;
        left: 5px;
        top: 2px;
        width: 5px;
        height: 9px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
      }
    }

    &:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(37, 184, 100, 0.2);
    }
  }
  ul[data-type="taskList"] li[data-checked="true"] > div {
    text-decoration: line-through;
    color: var(--muted, #737373);
  }

  /* 占位提示 */
  p.is-editor-empty:first-child::before {
    content: attr(data-placeholder);
    color: var(--muted, #737373);
    float: left;
    height: 0;
    pointer-events: none;
  }

  img {
    display: block;
    margin: 0.75rem auto;
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-lg, 8px);
    border: 1px solid var(--border);

    &.ProseMirror-selectednode {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
  }

  div[data-bilibili-video] {
    &:hover { border: 2px solid var(--border); }
  }

  .image-class {
    border: 1px solid var(--border);
    border-radius: var(--radius-lg, 8px);
  }
}

/* 拖拽手柄样式 */
.drag-handle-wrapper {
  position: absolute;
  left: -32px;
  top: 0;
  height: 100%;
  display: flex;
  align-items: center;
  z-index: 10;
  user-select: none;
}

.drag-handle {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: grab;
  opacity: 0;
  transition: opacity 0.2s ease;
  color: var(--gray-400, #a3a3a3);
  border-radius: var(--radius-sm, 4px);

  &:hover {
    opacity: 1 !important;
    color: var(--gray-600, #525252);
    background: var(--gray-100, #f5f5f5);
  }

  &:active {
    cursor: grabbing;
  }

  &.visible {
    opacity: 0.4;
  }

  svg {
    width: 18px;
    height: 18px;
    pointer-events: none;
  }
}

/* 悬停时显示拖拽手柄 */
.ProseMirror > * {
  position: relative;

  &:hover .drag-handle {
    opacity: 0.6;
  }
}

/* 拖拽时的样式 */
.drag-handle-wrapper.is-dragging {
  opacity: 0.4;
}

/* 拖拽指示器（蓝色线条） */
.drop-indicator {
  position: absolute;
  left: 0;
  right: 0;
  height: 2px;
  background: var(--primary, #25b864);
  pointer-events: none;
  z-index: 100;

  &::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--primary, #25b864);
  }
}

.bubble-menu {
  display: flex;
  align-items: center;
  gap: 2px;
  background-color: var(--bubble-bg, #1f1f1f);
  padding: 6px 8px;
  border-radius: var(--radius-md, 6px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.05);

  button,
  .ant-btn {
    border: none !important;
    background: transparent !important;
    color: var(--bubble-fg, rgba(255, 255, 255, 0.85)) !important;
    font-size: 14px;
    font-weight: 500;
    padding: 4px 8px;
    min-width: 28px;
    height: 28px;
    border-radius: var(--radius-sm, 4px);
    transition: all 0.15s ease;

    &:hover {
      background: rgba(255, 255, 255, 0.1) !important;
      color: white !important;
    }

    &.is-active {
      background: var(--primary, #25b864) !important;
      color: white !important;
    }

    .anticon {
      font-size: 14px;
    }
  }

  // 分隔线
  &::before {
    display: none;
  }
}

.markdown {
  height: 100%;
  background: var(--bg);
  overflow: hidden;
  display: flex;
  flex-direction: column;

  // EditorContent 需要填满剩余空间
  > .tiptap,
  > div:last-child {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }

  .title {
    font-size: 28px;
    font-weight: 700;
    color: var(--fg);
  }

  .footer {
    text-align: right;
    padding: var(--spacing-lg) var(--spacing-xl);
    background: var(--bg);
    border-top: 1px solid var(--border);
  }
}

/* 嵌入式内容样式 */

/* YouTube 嵌入 */
.youtube-embed-wrapper {
  position: relative;
  margin: 1.5rem 0;

  .youtube-embed-container {
    position: relative;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
    height: 0;
    overflow: hidden;
    border-radius: var(--radius-lg, 8px);
    background: var(--gray-100);
  }

  .youtube-embed-iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
    border-radius: var(--radius-lg, 8px);
  }

  .youtube-embed-placeholder {
    padding: 2rem;
    text-align: center;
    color: var(--muted, #737373);
    background: var(--gray-50);
    border: 1px dashed var(--border);
    border-radius: var(--radius-lg, 8px);
  }
}

/* PDF 嵌入 */
.pdf-embed-wrapper {
  position: relative;
  margin: 1.5rem 0;

  .pdf-embed-container {
    border: 1px solid var(--border);
    border-radius: var(--radius-lg, 8px);
    background: var(--gray-50);
    padding: 1rem;
    text-align: center;
  }

  .pdf-embed-loading,
  .pdf-embed-error,
  .pdf-embed-placeholder {
    padding: 2rem;
    color: var(--muted, #737373);
  }

  .pdf-embed-error {
    color: #dc2626;
  }

  .react-pdf__Document {
    display: flex;
    justify-content: center;
  }

  .react-pdf__Page {
    max-width: 100%;
    canvas {
      max-width: 100%;
      height: auto !important;
    }
  }

  .pdf-controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border);
  }

  .pdf-control-button {
    padding: 0.5rem 1rem;
    background: var(--bg, white);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm, 4px);
    color: var(--fg);
    cursor: pointer;
    transition: all 0.2s;

    &:hover:not(:disabled) {
      background: var(--gray-100);
      border-color: var(--primary);
    }

    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  }

  .pdf-page-info,
  .pdf-zoom-info {
    color: var(--muted);
    font-size: 0.875rem;
    min-width: 60px;
    text-align: center;
  }

  .pdf-controls-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .pdf-document-wrapper {
    transition: transform 0.2s ease;
    overflow: auto;
    max-height: 600px;
  }

  .pdf-fullscreen-button {
    margin-left: 1rem;
    font-size: 1.2rem;
  }

  &.pdf-fullscreen {
    background: rgba(0, 0, 0, 0.95);
    padding: 2rem;
    border-radius: 0;
    max-width: 100%;
    max-height: 100%;

    .pdf-document-wrapper {
      max-height: calc(100vh - 150px);
      overflow: auto;
    }

    .pdf-controls {
      background: rgba(0, 0, 0, 0.8);
      padding: 1rem;
      border-radius: var(--radius-lg, 8px);
      border: none;
      margin-top: 1rem;
    }

    .pdf-control-button {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.2);
      color: white;

      &:hover:not(:disabled) {
        background: rgba(255, 255, 255, 0.2);
        border-color: var(--primary);
      }
    }

    .pdf-page-info,
    .pdf-zoom-info {
      color: rgba(255, 255, 255, 0.8);
    }
  }
}

/* PDF 全屏遮罩 */
.pdf-fullscreen-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.95);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2rem;
}

/* 网页预览 */
.web-embed-wrapper {
  position: relative;
  margin: 1.5rem 0;

  .web-embed-card {
    display: block;
    border: 1px solid var(--border);
    border-radius: var(--radius-lg, 8px);
    padding: 1rem;
    background: var(--bg, white);
    text-decoration: none;
    transition: all 0.2s;

    &:hover {
      border-color: var(--primary);
      box-shadow: 0 2px 8px rgba(37, 184, 100, 0.1);
    }
  }

  .web-embed-loading,
  .web-embed-error,
  .web-embed-placeholder {
    padding: 2rem;
    text-align: center;
    color: var(--muted, #737373);
  }

  .web-embed-content {
    flex: 1;
  }

  .web-embed-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .web-embed-favicon {
    width: 20px;
    height: 20px;
    object-fit: contain;
  }

  .web-embed-title {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
    color: var(--fg);
  }

  .web-embed-description {
    margin: 0;
    font-size: 0.875rem;
    color: var(--muted);
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .web-embed-controls {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid var(--border);
  }

  .web-embed-button {
    padding: 0.35rem 0.75rem;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm, 4px);
    color: var(--fg);
    font-size: 0.875rem;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s;

    &:hover {
      background: var(--gray-100);
      border-color: var(--primary);
      color: var(--primary);
    }
  }

  .web-embed-iframe-container {
    border: 1px solid var(--border);
    border-radius: var(--radius-lg, 8px);
    overflow: hidden;
    background: var(--gray-50);
  }

  .web-embed-iframe {
    width: 100%;
    height: 500px;
    border: none;
  }
}

/* 通用嵌入删除按钮 */
.embed-delete-button {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: none;
  background: rgba(0, 0, 0, 0.6);
  color: white;
  font-size: 14px;
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;

  &:hover {
    background: rgba(220, 38, 38, 0.9);
  }
}

.youtube-embed-wrapper:hover .embed-delete-button,
.pdf-embed-wrapper:hover .embed-delete-button,
.web-embed-wrapper:hover .embed-delete-button {
  opacity: 1;
}

/* 标签节点样式 */
.tag-node {
  display: inline-block;
  padding: 2px 8px;
  margin: 0 4px 0 0;
  background: var(--tag-bg, #f0f9ff);
  color: var(--tag-color, #0369a1);
  border-radius: var(--radius-sm, 4px);
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  border: 1px solid var(--tag-border, #bae6fd);
  user-select: none;

  &:hover {
    background: var(--tag-hover-bg, #0369a1);
    color: var(--tag-hover-color, white);
    border-color: var(--tag-hover-border, #0369a1);
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(3, 105, 161, 0.2);
  }

  &:active {
    transform: translateY(0);
  }
}

// 暗黑模式标签样式
[data-theme="dark"] .tag-node {
  --tag-bg: rgba(14, 165, 233, 0.15);
  --tag-color: #7dd3fc;
  --tag-border: rgba(14, 165, 233, 0.3);
  --tag-hover-bg: #0284c7;
  --tag-hover-color: white;
  --tag-hover-border: #0284c7;
}

/* 内部链接样式 */
.internal-link {
  color: var(--primary, #25b864);
  text-decoration: none;
  border-bottom: 1px dashed var(--primary, #25b864);
  cursor: pointer;
  transition: all 0.2s ease;
  font-weight: 500;
  padding: 0 2px;

  &:hover {
    color: var(--primary-hover, #1fa354);
    border-bottom-style: solid;
    border-bottom-width: 2px;
    background: var(--primary-light, #e6f7ef);
  }

  &.not-exists {
    color: var(--error, #ef4444);
    border-bottom-color: var(--error, #ef4444);
    border-bottom-style: dotted;

    &:hover {
      color: #dc2626;
      border-bottom-color: #dc2626;
      background: #fee;
    }
  }
}

// 暗黑模式链接样式
[data-theme="dark"] .internal-link {
  &.exists {
    color: var(--primary, #25b864);
    border-bottom-color: var(--primary, #25b864);

    &:hover {
      background: rgba(37, 184, 100, 0.15);
    }
  }

  &.not-exists {
    color: #f87171;
    border-bottom-color: #f87171;

    &:hover {
      color: #fca5a5;
      border-bottom-color: #fca5a5;
      background: rgba(239, 68, 68, 0.1);
    }
  }
}

// 未来编辑器功能样式（为其他功能预留）

// 拖拽手柄
.drag-handle {
  position: absolute;
  left: -24px;
  width: 18px;
  height: 18px;
  color: var(--gray-400);
  cursor: grab;
  opacity: 0;
  transition: opacity 0.15s;

  &:hover {
    color: var(--gray-600);
    opacity: 1;
  }

  &:active {
    cursor: grabbing;
  }
}

.ProseMirror > *:hover .drag-handle {
  opacity: 0.6;
}

// 斜杠命令菜单
.slash-menu {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-md, 6px);
  box-shadow: var(--shadow-md);
  padding: 4px;
  max-height: 320px;
  overflow-y: auto;

  .slash-menu-item {
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: var(--radius-sm, 4px);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    transition: background 0.15s;

    &:hover, &.selected {
      background: var(--gray-100);
    }

    .icon { font-size: 18px; }
    .title { font-size: 14px; color: var(--fg); }
    .description { font-size: 12px; color: var(--muted); }
  }
}

// 块操作菜单（同斜杠菜单样式）
.block-menu {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-md, 6px);
  box-shadow: var(--shadow-md);
  padding: 4px;
}

// 嵌入内容样式
.youtube-wrapper,
.pdf-wrapper,
.link-preview-card {
  border: 1px solid var(--border);
  border-radius: var(--radius-lg, 8px);
  overflow: hidden;
  margin: 1rem 0;
  background: var(--bg);

  iframe {
    width: 100%;
    border: none;
  }
}

.link-preview-card {
  display: flex;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
  text-decoration: none;
  transition: background 0.15s;

  &:hover {
    background: var(--gray-50);
  }

  img {
    width: 120px;
    height: 80px;
    object-fit: cover;
    border-radius: var(--radius-sm);
  }

  .link-preview-content {
    flex: 1;

    h4 {
      margin: 0 0 var(--spacing-xs) 0;
      font-size: 14px;
      font-weight: 600;
      color: var(--fg);
    }

    p {
      margin: 0 0 var(--spacing-xs) 0;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.4;
    }

    .link-preview-url {
      font-size: 12px;
      color: var(--gray-400);
    }
  }
}

// 拖拽指示器
.drag-indicator {
  height: 2px;
  background: var(--primary);
  border-radius: 1px;
}

/* ==================== 暗色模式全面适配 ==================== */
@media (prefers-color-scheme: dark) {
  .markdown {
    --fg: #e5e5e5;
    --bg: #171717;
    --muted: #a3a3a3;
    --border: #404040;
    --gray-50: #262626;
    --gray-100: #303030;
    --gray-200: #404040;
    --gray-300: #525252;
    --gray-400: #737373;
    --gray-800: #e5e5e5;
    --gray-900: #0a0a0a;
    --primary-light: rgba(37, 184, 100, 0.15);
  }
}

/* 手动暗色模式类 */
.markdown[data-theme="dark"],
.markdown.dark-mode {
  --fg: #e5e5e5;
  --bg: #171717;
  --muted: #a3a3a3;
  --border: #404040;
  --gray-50: #262626;
  --gray-100: #303030;
  --gray-200: #404040;
  --gray-300: #525252;
  --gray-400: #737373;
  --gray-800: #e5e5e5;
  --gray-900: #0a0a0a;
  --primary-light: rgba(37, 184, 100, 0.15);

  .ProseMirror {
    pre {
      background: #0d0d0d;
      border: 1px solid var(--border);
    }

    code {
      background: var(--gray-100);
      border-color: var(--border);
      color: #f0abfc;
    }

    blockquote {
      background: var(--gray-100);
      border-left-color: var(--gray-400);
    }

    table {
      thead th {
        background: var(--gray-100);
      }
      tbody tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.03);
      }
      tbody tr:hover {
        background: rgba(37, 184, 100, 0.1);
      }
    }

    img {
      border-color: var(--border);
    }
  }

  .bubble-menu {
    --bubble-bg: #2a2a2a;
    --bubble-fg: rgba(255, 255, 255, 0.9);
    background: var(--bubble-bg);
    border: 1px solid var(--border);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.08);
  }
}
